<!DOCTYPE html><html><head>
<meta charset="UTF-8">
<title>icmake</title>
<style type="text/css">
    figure {text-align: center;}
    img {vertical-align: center;}
</style>
<link rev="made" href="mailto:Frank B. Brokken: f.b.brokken@rug.nl">
</head>
<body text="#27408B" bgcolor="#FFFAF0">
<hr>
<h1>icmake</h1>
<h2>icmake.7.23.01.tar.gz</h2>
<h2>1992-2015</h2>

<!DOCTYPE html><html><head>
<meta charset="UTF-8">
<style type="text/css">
    figure {text-align: center;}
    img {vertical-align: center;}
    figure {text-align: center;}
    img {vertical-align: center;}
</style>
<link rev="made" href="mailto:Frank B. Brokken: f.b.brokken@rug.nl">
</head>
<body text="#27408B" bgcolor="#FFFAF0">
<hr>
<h1></h1>

<!DOCTYPE html><html><head>
<meta charset="UTF-8">
<title>icmake(1)</title>
<style type="text/css">
    figure {text-align: center;}
    img {vertical-align: center;}
    figure {text-align: center;}
    img {vertical-align: center;}
    figure {text-align: center;}
    img {vertical-align: center;}
</style>
<link rev="made" href="mailto:Frank B. Brokken: f.b.brokken@rug.nl">
</head>
<body text="#27408B" bgcolor="#FFFAF0">
<hr>
<h1>icmake(1)</h1>
<h2>icmake.7.23.01.tar.gz A program maintenance utility</h2>
<h2>1992-2015</h2>


<p>

<h2>NAME</h2>icmake - A program maintenance (<em>make</em>) utility using a
                    <strong>C</strong>-like grammar
<p>

<h2>SYNOPSIS</h2>
       <strong>icmake</strong> [options] <em>source[.im] [dest[.bim]]</em> [-- [args]]
<p>
<strong>icmun</strong> <em>bimfile</em>
<p>
<h2>DESCRIPTION</h2>
<p>
<strong>Icmake</strong>(1) can be used as an alternative to <strong>make</strong>(1). In its standard
operation more, it calls the following programs:
    <ul>
        <li><em>icm-pp</em>  to preprocess the icmake file 
        <li><em>icm-comp</em>   to byte-code compile the <strong>icmake</strong>  <strong>s</strong>
        <li><em>icm-exec</em>   to interpret the byte-code file
    </ul>
<p>
<strong>Icmake</strong> allows the programmer to use a program language (closely resembling
the well-known <strong>C</strong>-programming language) to define the actions involved in
(complex) program maintenance. For this, <strong>icmake</strong> offers various special
operators as well as a set of support functions that have proven to be useful
in program maintenance.
<p>
The program <strong>icmun</strong>(1) may be used to disassemble the compiled 
byte-code file.
<p>
Traditional make-utilities recompile sources once header files are
modified. In the context of <strong>C++</strong> program development this is often a bad
idea, as adding a new member to a class does not normally require you to
recompile the class's sources. To handle class dependencies in a more sensible
way, <strong>icmake</strong>(1)'s <em>CLASSES</em> file may define dependencies among
classes. By default, class-dependencies are not interpreted. See the
<strong>icmconf</strong>(7) man-page for details.
<p>
<h2>ADDITONS SINCE VERSION 7.00</h2>
<p>
<ul>
    <li> Integral constants may be specified using hexadecimal notation (e.g.,
        <em>0x12ab</em>); 
    <li> The <em>IM</em> environment variable may contain multiple directories,
        separated from each other by colons (<em>:</em>).
    <li><em>#define</em>-directives may refer to other macro definitions using the
        <em>${identifier}</em> format.
    <li><em>#ifdef</em>, <em>#ifndef</em>, <em>#else</em> and <em>#endif</em> directives can be
        nested. 
    <li> The `backtick' operator is defined, executing a program in a shell
        and collecting its standard output in a list (see below).
    <li> The index operator (<em>[]</em>) is defined as an alternative to the
        pre-defined function <em>element()</em>, and can be used on lists and
        strings. 
    <li> The function <em>string getenv(string envvar)</em> is predefined. If
        existing scripts already define a <em>getenv()</em> function of their own,
        it it suggested to remove this function and use the new <em>getenv()</em>
        function instead. Alternatively, rename the script-defined function
        <em>getenv()</em> and calls of this function to, e.g. <em>my_getenv()</em>.
    <li> The function <em>int strstr(string haystack, string needle)</em> is 
        renamed to <em>int strfind(string haystack, string needle)</em>. 
<p>
<strong>NOTE: this modification in version 7.00 could very well
        affect your earlier (6.xx) icmake scripts. Changing `strstr'
        into `strfind' should bring your older scripts up-to-date again.</strong>
    </ul>
<p>
<h2>OPTIONS</h2>
<p>
<strong>Icmake</strong>:
<p>
<em>source</em>: <strong>icmake</strong> script source file (default extension: <em>.im</em>).
<p>
<em>dest</em>:   binary <strong>icmake</strong> script file (default:  <em>`source'.bim</em>).
<p>
<em>--</em>:  <strong>icmake</strong>/<strong>icmake</strong>-script arguments separator
<p>
<em>args</em>:  arguments following <em>--</em> are entered into the <strong>icmake</strong> scipt 
            <em>main()</em> function's <em>argv</em>-list (see below at section
            <strong>USER DEFINED FUNCTIONS</strong>).
<p>
<ul>
    <li> <strong>-a</strong>  <br>information about <strong>icmake</strong>
    <li> <strong>-b</strong>  <br>blunt execution of the destinationfile
    <li> <strong>-c</strong>  <br>the destination file is only compiled
    <li> <strong>-i</strong> file <br><em>file</em>: name of source.  <strong>Icmake</strong> argument processing stops.
    <li> <strong>-o</strong> file <br>all <strong>icmake</strong> output is written to <em>file</em> (Not
                        implemented on unix platforms)
    <li> <strong>-p</strong>  <br>only the preprocessor is activated
    <li> <strong>-q</strong>  <br>quiet mode: copyright banner not displayed
    <li> <strong>-t</strong> file <br><em>file</em> is used as a temporary bim-file, to be
                        removed on exit. <strong>Icmake</strong> argument processing stops.
    </ul>
<p>
<strong>Icmun</strong>:
<p>
<em>bimfile</em>:  binary <strong>icmake</strong> script file.
<p>
<h2>PREPROCESSOR DIRECTIVES</h2>
<p>
The following preprocessor directives are available:
    <ul>
    <li> comment:<br>
       standard <strong>C</strong> comment (all between <em>/*</em> and <em>*/</em>) as well as
        comment-to-end-of-line (all line contents following <em>//</em>) are
        ignored.
    <li> Shell startup: The first line of the <strong>icmake</strong>-script may start with
        <em>#!path</em>, where <em>path</em> defines the absolute location of the <strong>icmake</strong>
        program. By making the script executable, it can be called without
        explicitly calling <strong>icmake</strong>.  
<p>
E.g., if the first line of an (executable) icmakefile 'icm'
                  (without extension) contains
        <pre>

            #!/usr/bin/icmake -qi
        
</pre>

       then <em>icm</em> may be given as a command, thus executing
        <pre>

            /usr/bin/icmake -qi icm ...
        
</pre>

       Alternatively, 
        <pre>

            #! /usr/bin/icmake -qt /tmp/icm
        
</pre>

       may be used, resulting in the execution of
        <pre>

            #! /usr/bin/icmake -qt /tmp/icm icm ...
        
</pre>

       In this case the binary makefile is not kept, but a temporary file
        <em>/tmp/icm.PID</em> is used and removed on exit. The PID extension being
        the process-id of the <strong>icmake</strong> program executing <em>icm</em>.
    <li><em>#include "filename"</em><br>
        The file <em>filename</em> is included at the location of the directive
    <li><em>#include &lt;filename&gt;</em><br>
        The file <em>filename</em> is included at the location of the <em>#include</em>
        directive; <em>filename</em> is searched in the directories pointed to by 
        the <em>IM</em> environment variable.
    <li><em>#define identifier definition</em><br>
        The text <em>identifier</em> will be replaced by <em>definition</em>. The
        definition may contain references to already defined identifiers,
        using the <em>${identifier}</em> format. If the <em>${identifier}</em> hasn't
        been defined (yet), the text <em>${identifier}</em> is literally kept. At
        each <em>#define</em> at most 100 text-replacements are performed,
        preventing infinite recursion.
    <li><em>#ifdef identifier</em><br>
        If the <em>identifier</em> macro was defined the next block of code (until
        a matching <em>#else</em> or <em>#endif</em> directive was detected) is
        byte-compiled. Otherwise, the block of code is ignored.
    <li><em>#ifndef identifier</em><br> 
        If the <em>identifier</em> macro was <em>not</em> defined the next block of code
        (until a matching <em>#else</em> or <em>#endif</em> directive was detected) is
        byte-compiled. Otherwise, the block of code is ignored.
    <li><em>#else</em><br>
        Terminates a <em>#ifdef</em> and <em>#ifndef</em> directive, reversing the
        acceptance decision about  the following code.
    <li><em>#endif</em><br>
        Terminates the preprocessor block starting at the matching 
        <em>#ifdef</em>, <em>#ifndef</em> or <em>#else</em> directive.
    <li><em>#undef identifier</em> <br>
        Remove <em>identifier</em> from the set of defined symbols. This will not
        affect the specification of any previously defined symbols in which
        <em>identifier</em> was used.
    </ul>
<p>
<h2>DATA TYPES</h2>
<p>
The following data types are available:
    <ul>
    <li><em>int</em><br>
        Integral values, ranging from <em>-0x8000</em> until <em>0x7fff</em>. <em>int</em>
        constants may be specified as decimal numbers, hexadecimal numbers or
        as <em>ASCII</em> character constants (e.g., <em>'x'</em>).
    <li><em>string</em><br>
       Text variables. Text constants are delimited by double quotes. Multiple
        text constants may be concatenated, but a text constant may not extend
        over multiple lines. To indicate an end-of-line in a text constant use
        the <em>\n</em> escape sequence. The escape sequences <em>\a \b \f \n \r</em>
        and <em>\t</em> are available. Otherwise, <em>\x</em> is interpreted as a
        literal <em>x</em>. So, use <em>\\</em> to indicate <em>\</em> within a text
        constant. 
    <li><em>list</em><br>
       A data structure containing a series of individually accessible
        <em>string</em> values. When a list contains elements, its first element is
        indicated by index 0.
    <li><em>void</em><br>
       Used with function definitions to indicate that the function does not
        return a value.
    </ul>
<p>
Variables may be defined both at the global level as well as locally to
functions. Variables are strongly typed. A variable cannot have the type 
<em>void</em>.
<p>
Variables may be initialized when they are defined. The initialization can
use return values of functions, but cannot use variables. Consider
initializations as being constructed from constant values.
<p>
<h2>PREDEFINED SYMBOLS</h2>
<p>
The following symbols are predefined by <strong>icmake</strong>. All are constant <em>int</em> 
        values:
    <table>

        <td colspan=3><hr></td>

        
<tr>
<td> symbol</td><td> value</td><td> intended for</td>
 
</tr>

        <td colspan=3><hr></td>

        
<tr>
<td> O_ALL</td><td> 8</td><td> makelist</td>
 
</tr>

        
<tr>
<td> O_DIR</td><td> 2</td><td> makelist</td>
 
</tr>

        
<tr>
<td> O_FILE</td><td> 1</td><td> makelist</td>
 
</tr>

        
<tr>
<td> O_SUBDIR</td><td> 4</td><td> makelist</td>
 
</tr>

        <td colspan=3><hr></td>

        
<tr>
<td> OFF</td><td> 0</td><td> echo</td>
 
</tr>

        
<tr>
<td> ON</td><td> 1</td><td> echo</td>
 
</tr>

        <td colspan=3><hr></td>

        
<tr>
<td> P_CHECK</td><td> 0</td><td> system calls</td>
 
</tr>

        
<tr>
<td> P_NOCHECK</td><td> 1</td><td> system calls</td>
 
</tr>

        <td colspan=3><hr></td>

        
<tr>
<td> S_IEXEC</td><td> 32</td><td> stat</td>
 
</tr>

        
<tr>
<td> S_IFCHR</td><td> 1</td><td> stat</td>
 
</tr>

        
<tr>
<td> S_IFDIR</td><td> 2</td><td> stat        </td>
 
</tr>

        
<tr>
<td> S_IFREG</td><td> 4</td><td> stat</td>
 
</tr>

        
<tr>
<td> S_IREAD</td><td> 8</td><td> stat        </td>
 
</tr>

        
<tr>
<td> S_IWRITE</td><td> 16</td><td> stat</td>
 
</tr>

        <td colspan=3><hr></td>

    
</table>
<p>
The following symbols are available depending on the architecture:
    <table>

        <td colspan=2><hr></td>

        
<tr>
<td> symbol</td><td> 1 when defined on the platform, otherwise 0</td>
 
</tr>

        <td colspan=2><hr></td>

        
<tr>
<td> MSDOS</td> <td> MS-DOS platform (with MSC 7.00 compiler)</td>
 
</tr>

        
<tr>
<td> unix</td>  <td> Unix, usually with GNU's gcc compiler</td>
 
</tr>

        
<tr>
<td> linux</td> <td> x86 running Linux (usually with gcc)</td>
 
</tr>

        
<tr>
<td> M_SYSV, M_UNIX</td>
                    <td> x86 running SCO/Unix (usually with) Microsoft C</td>
 
</tr>

        
<tr>
<td> _POSIX</td><td> _SOURCE   Unix with Posix complient compiler</td>
 
</tr>

        
<tr>
<td> __hpux</td><td> HP-UX, with the native HP compiler</td>
 
</tr>

        <td colspan=2><hr></td>

    
</table>
<h2>OPERATORS</h2>
<p>
All <strong>C</strong> operators, except for the ternary operator, are supported,
operating like their <strong>C</strong> counterparts on <em>int</em> variables and/or values.
<p>
Additionally, for <em>string</em> type variables and/or values the following
operators are available:
    <ul>
    <li><em>a + b</em>: returns a new <em>string</em> value containing the concatenation of
<em>string</em> values <em>a</em> and <em>b</em>. Note that <em>string</em> constants may be
concatetated without using the <em>+</em> operator, e.g.,
        <pre>

    "hello "   "world"
    "hello " + "world"
        
</pre>

    <li><em>a += b</em>: <em>a</em> must be a  <em>string</em> variable, to which the <em>string</em>
variable or value <em>b</em> is appended.
    <li> string comparisons: operators <em>== != &lt;= &gt;= &lt; &gt; !=</em> and <em>==</em> may
be applied to <em>string</em> values or variables, returning 1 if the comparison
succeeds, otherwise 0. Comparison is case sensitively, and follows the
<em>ASCII</em> character set.
    <li><em>!a</em>: the boolean <em>!</em> operator returns 1 if the <em>string a</em> is
empty, otherwise 0 is returned.
    <li><em>a younger b, a newer b</em>: returns 1 if file <em>a</em> is more recent than
file <em>b</em>. E.g., <em>"source.cc" newer "source.o"</em>. If <em>b</em> doesn't exist, 1
is returned; if <em>a</em> doesn't exist 0 is returned; if neither <em>a</em> nor <em>b</em>
exists, 0 is returned; if they are of the same age, 0 is returned. Explicit
tests for the existence of a file can be performed using the <em>exists()</em>
predefined function (see below, section <strong>PREDEFINED FUNCTIONS</strong>).
    <li><em>a older b</em>: turns 1 if file <em>a</em> is older than file <em>b</em>. E.g.,
<em>"libprog.a" older "source.o"</em>. If <em>a</em> doesn't exist, 1 is returned; if
<em>b</em> doesn't exist 0 is returned; if neither <em>a</em> nor <em>b</em> exists, 0 is
returned; if they are of the same age, 0 is returned.
    <li><em>[]</em>: the index operator is defined as an alternative to the built-in
function <em>element</em>. It can only be applied (as holds true for <em>element()</em>
as well) as so-called <em>rvalue</em>. Therefore, constructions like:
        <pre>

        // assume str1 and str2 are strings
    str1 = str2[3]
        
</pre>

    will be accepted, but the following construction will not be accepted:
        <pre>

    str2[3] = str; // won't compile
        
</pre>

    </ul>
<p>
For <em>list</em> type variables and/or values the following
operators are available:
    <ul>
    <li><em>a + b</em>: returns a new <em>list</em> value containing the concatenation of
<em>list</em> values <em>a</em> and <em>b</em>. This is <em>not</em> a set operation: if an
element appears both in <em>a</em> and in <em>b</em>, they will appear twice in the
resulting list.
    <li><em>a - b</em>: returns a new <em>list</em> value containing the elements in <em>a</em>
that are not present in <em>b</em>. This <em>is</em> a set operation.
    <li><em>a += b</em>: elements in <em>b</em> are added to the elements in <em>a</em>, which 
must be a  <em>list</em> variable.  This is <em>not</em> a set operation.
    <li><em>a -= b</em>: elements in <em>b</em> are removed from the elements in <em>a</em>,
which must be a <em>list</em> variable.  This <em>is</em> a set operation.
    <li> list equality comparisons: operators <em>!=</em> and <em>==</em> may be applied
to <em>list</em> values or variables. Operator <em>==</em> returns 1 if both lists have
element-by-element identical elements, 0 otherwise. Operator <em>!=</em> reverses
the result of <em>==</em>.
    <li><em>!a</em>: the boolean <em>!</em> operator returns 1 if the <em>list a</em> is
empty, otherwise 0 is returned.
    <li><em>[]</em>: the index operator is defined as an alternative to the built-in
function <em>element</em>. It can only be applied (as holds true for <em>element()</em>
as well) as so-called <em>rvalue</em>. Therefore, constructions like:
        <pre>

        // assume lst is a list, str is a string
    str = lst[3]
        
</pre>

    will be accepted, but the following construction will not be accepted:
        <pre>

    lst[3] = str; // won't compile
        
</pre>

    </ul>
<p>
Typecasts may be performed using the standard <strong>C</strong> cast-operator to cast:
    <ul>
    <li> Strings to ints and vice versa (<em>(int)"123", (string)55</em>)
    <li> Strings may be cast to lists (<em>list lst = (list)"hello"</em>)
    </ul>
<p>
<h2>FLOW CONTROL</h2>
<p>
<strong>Icmake</strong> offers the following subset of <strong>C</strong>'s statement types. They can be
used as in the <strong>C</strong> programming language.
    <ul>
    <li><em>expression ;</em><br>
        The plain expression statement;
    <li> The compound statement <br>
        Different from <strong>C</strong> <strong>icmake</strong> does not support variable definitions
        inside a compound statement. All variables used locally
        by a function must be defined as either function parameters or
        as variables that are defined immediately at the beginning of a
        function's body.
    <li><em>if (condition) statement</em>
    <li><em>if (condition) statement else statement</em>
    <li><em>for (init; condition; increment) statement</em><br>
        The variable(s) used in the initialization section must already have
        been defined. The <em>init</em>, <em>condition</em> and <em>increment</em> sections
        may be left empty. The empty condition section is interpreted as
        `always <em>true</em>'.
    <li><em>while (condition) statement</em><br>
        The <em>do ... while()</em> statement is not implemented for <strong>icmake</strong>.
    <li><em>return</em> (for <em>void</em> functions) and <em>return expression</em> for other
        functions. 
    <li><em>break</em><br>
        To leave <em>for</em> and <em>while</em> statements, overruling the statement's
        condition. <strong>C</strong>'s <em>continue</em> is not available.
    <li><em>exit(expression)</em><br>
        To terminate the <strong>icmake</strong>-script. The <em>expression</em> must evaluate to an
        <em>int</em> value, which becomes the script's exit value.
    </ul>    
<p>
<h2>PREDEFINED FUNCTIONS</h2>
<p>
<strong>Icmake</strong> offers the following predefined functions, which can be used
immediately by <strong>icmake</strong> scripts. The function overview is ordered alphabetically
by function name, but where appropriate short summary labels are
provided: 
<p>
Helper functions of <em>exec()</em> (see also below at <em>exec()</em>):
    <ul>
    <li><em>void arghead(string h)</em><br>
        Defines the `argument head', to be used with <em>exec()</em>. By default,
        the `argument head' is an empty string.
    <li><em>void argtail (string t)</em><br>
        Defines the `argument tail', to be used with <em>exec()</em>. By default,
        the `argument tail' is an empty string.
    </ul>
<p>
String-to-ascii converters:
    <ul>
    <li><em>int ascii(string s)</em><br>
        Returns the first character of <em>s</em> as an int; e.g.,
        <em>ascii("A")</em> returns 65;
    <li><em>string ascii(int i)</em><br>
        Returns <em>i</em> as a string, e.g., <em>ascii(65)</em> returns the string
        <em>"A"</em>;
    </ul>
<p>
System calls:
    <ul>
    <li> The `backtick` operator (<em>`</em>)<br>
        A string placed between two backticks is executed by the <em>popen</em>(3)
        function. The standard output gererated by the command that is stored
        in the string argument is returned as a list. An empty list indicates
        that the command could not be executed. A command that could be
        executed but did not produce any output returns a list containing one
        empty element. The command's standard error stream output is not
        automatically collected. Standard shell redirection could be used to
        collect the standard error stream's output as well. Example:
            <pre>

        string s = "ls";
        printf(`s`);        // prints the elements in the current
                            // directory
            
</pre>

    </ul>
<p>
Filename modifiers:
    <ul> 
    <li><em>string change_base(string file, string newbase)</em><br>
        Changes the basename of <em>file</em>, returns the changed name. E.g, 
        <em>change_base("/path/demo.im", "out")</em> returns <em>"/path/out.im"</em>;
    <li><em>string change_ext(string file, string newext)</em><br>
        Changes the extension of <em>file</em>, returns the changed name. E.g, 
        <em>change_ext("source.cc", "o")</em> returns <em>"source.o"</em>;
    <li><em>string change_path(string file, string newpath)</em><br>
         Changes the path specification of <em>file</em>, returns the changed name.
        E.g, <em>change_path("tmp/binary", "/usr/bin")</em> returns 
        <em>"/usr/bin/binary"</em>. Note that the <em>/</em>-separator is inserted if
        required. 
    </ul>
<p>
System calls:
    <ul>
    <li><em>string chdir(string newdir)</em><br>
        Changes the script's working directory, returns the previous dir as an
        absolute path.<br>
        Use <em>chdir(".")</em> to get current working directory, 
        <em>chdir("")</em> may be used to obtain the startup working directory (this
        functionality was broken in releases before than 7.00, but is now
        operational). The function terminates the <strong>icmake</strong>-script if the
        specified <em>newdir</em> does not exist.
    <li><em>string chdir(int checking, string newdir)</em><br>
        Same functionality as the previous function, but by specifying
        <em>checking</em> as <em>P_NOCHECK</em> the function won't terminate the
        script. Rather, it will return the script's current working
        directory. 
    </ul>
<p>
Helper functions of <em>exec()</em> (see also below at <em>exec()</em>):
    <ul>
    <li><em>cmdhead(string h)</em><br>
        Defines a `command head', to be used with <em>exec()</em>. By default,
        the `command head' is an empty string.
    <li><em>cmdtail(string t)</em><br>
        Defines a `command tail', to be used with <em>exec()</em>. By default,
        the `command tail' is an empty string.
    </ul>
<p>
<strong>Icmake</strong> execution modifier:
    <ul>
    <li><em>echo(int opt)</em><br> 
       Controls echoing of called programs (and their arguments), specify
        <em>OFF</em> if echoing is not requested. By default <em>ON</em> is active.
    </ul>
<p>
Functions returning elements of aggregates:
    <ul>
    <li><em>string element(int index, list lst)</em><br>
        Returns string <em>index</em> (0-based) from <em>lst</em>. An empty string is
        returned if an unavailable index value is provided. See also the
        <em>[]</em> operator in the section <strong>OPERATORS</strong>.
    <li><em>string element(int index, string str)</em><br>
        Returns character <em>index</em> (0-based) from <em>str</em>. An empty string is
        returned if an unavailable index value is provided. See also the
        <em>[]</em> operator in the section <strong>OPERATORS</strong>.
    </ul>
<p>
System calls:
    <li><em>exec(string cmd, ...)</em><br>
       Executes command with arguments. Each argument will be prefixed by
        <em>arghead()</em>'s argument and postfixed by <em>argtail()</em>'s
        argument. Note that no blanks are inserted between <em>arghead()</em>'s
        contents, the argument proper, and <em>argtail()</em>'s argument. All thus
        modified arguments are concatenated, this time separated by single
        blanks, and then <em>cmdhead()</em>'s contents are inserted between the
        command and the first argument (on either side delimited by single
        blanks) and <em>cmdtail()</em>'s contents are appended to the arguments
        (again, separated by a single blank). <em>PATH</em> is searched to locate
        <em>cmd</em>. 0 is returned.
    <li><em>exec(int checkcmd, string cmd, ...)</em><br>
        Same functionality as the previous function, but by specifying
        <em>checking</em> as <em>P_NOCHECK</em> the function won't terminate the
        script. Rather, it will return the called command's exit status, or
        <em>0x7f00</em> if the command wasn't found.
    <li><em>execute(string cmd, string cmdhd,
            string arghd, ..., string argtl, string cmdtl)</em><br>
        Same as <em>exec()</em>, but command head/tail and argument
        head/tail must be specified. 
        The actually executed command starts with <em>cmd</em>, followed by 
        <em>cmdhd</em>. Next is a series of arguments follows, each 
        enclosed by <em>arghd</em> and <em>argtl</em>. The command terminates 
        with <em>cmdtl</em>. 0 is returned
    <li><em>execute(int checking, string cmd, string cmdhd,
            string arghd, ..., string argtl, string cmdtl)</em><br>
        Same functionality as the previous function, but by specifying
        <em>checking</em> as <em>P_NOCHECK</em> the function won't terminate the
        script. Rather, it will return the called command's exit status, or
        <em>0x7f00</em> if the command wasn't found.
    )
<p>
System interface:
    <ul>
    <li><em>int exists(string file)</em><br>
        Returns a non-zero value if <em>file</em> exists, otherwise 0 is returned. 
    </ul>
<p>
Input interface:
    <ul>    
    <li><em>list fgets(string file, int offset)</em><br>
        The next line found at offet <em>offset</em> is read from <em>file</em>. 
        It returns a list <em>retlist</em> containing two elements:<br>
        <em>element(0, retlist)</em> is the string that was read 
        (including the <em>\n</em>, if found)<br>
        <em>element(1, retlist)</em> is the next offset to read.<br>
<p>
An empty return list signifies <em>EOF</em>. Since an empty list's `first'
        eement is an empty string, which is converted to the value 0, a file
        may be read and processed as follows:
            <pre>

        list line;
        while (1)
        {
            line = fgets("filename", (int)line[1]);
            if (!line)
                break;
            process(line[0]);
        }
            
</pre>

        Note that the function <em>fgets</em> cannot read files beyond offset
        65536.
    </ul>
<p>
Output interface:
    <ul>    
    <li><em>int fprintf(string filename, ...)</em><br>
        Appends all (comma separated) arguments to the file
        <em>filename</em>. Returns the number of printed arguments.
    </ul>
<p>
Filename modifier:
    <ul>
    <li><em>string get_base(string file)</em><br>
        Returns the base name of <em>file</em>. The base name is the file without
        its path prefix and without its extension. The extension is all
        information starting at the final dot in the filename. If no final dot
        is found, the file name is the base name. Eg., the base name of
        <em>a.b</em> equals <em>a</em>, the base name of <em>a.b.c</em> equals <em>a.b</em>, the
        base name of <em>a/b/c</em> equals <em>c</em>. 
    </ul>
<p>
System interface:
    <ul>    
    <li><em>list getenv(string envvar)</em><br>
       Returns the value of environment variable <em>envvar</em> in a list
        containing two elements:<br> 
        the first element indicates whether the environment variable was
        defined (value <em>"1"</em>) or not (value <em>"0"</em>);<br>
        the second element indicates the value of the environment variable.
<p>
Enivironment variables are of the form <em>variable=value</em>, and if
        defined the list's second element contains <em>value</em>. If the value is
        empty, the variable is defined, but has no text associated with it.
    </ul>
<p>
Filename modifier:
    <ul>
    <li><em>string get_ext(string file)</em><br>
       Returns the extension of <em>file</em>, except for the separating dot. The
        extension is all information starting at the final dot
        in the filename. If no final dot is found, the extension is an empty
        string. 
    </ul>
<p>
Input interface:
    <ul>    
    <li><em>string getch()</em><br>
        Returns the next pressed key as a string (no `Enter' required for
        ms-dos and unix (incl. linux) systems).
    </ul>
<p>
Filename modifier:
    <ul>
    <li><em>string get_path(string file)</em><br> 
       Returns the path-prefix of <em>file</em>. The path prefix is all information
        up to (and including) the final directory separator (which is,
        depending on the operating system, a forward- or backslash).
<p>
If no path is found, an empty strring is returned.
    </ul>
<p>
System interface:
    <ul>    
    <li><em>int getpid()</em><br>
        Returns the process-id (UNIX) or PSP-paragraph (DOS) of the icmake byte
        code interpreter <strong>icm-exec</strong>.
    </ul>
<p>
Input interface:
    <ul>    
    <li><em>string gets()</em><br>
        Returns the next line read from the keyboard as a <em>string</em>. The line
        entered on the keyboard must be terminated by an `Enter' key, which is
        not stored in the returned string.
    </ul>
<p>
Functions creating lists of files:
    <ul>    
    <li><em>list makelist(string mask)</em><br>
        Returns a list of all files matching <em>mask</em>. E.g.,
        <em>makelist("*.c")</em> returns a list containing all files ending in
        <em>.c</em>. 
    <li><em>list makelist(type, string mask)</em><br>
        Same as the previous function, but the type of the directory elements
        may be specified as its first argument:
    <table>

        <td colspan=0><hr></td>

        
<tr>
<td> symbol</td><td> meaning</td> 
</tr>

        <td colspan=0><hr></td>

        
<tr>
<td> O_ALL</td><td> obtain all directory entries</td> 
</tr>

        
<tr>
<td> O_DIR</td><td> obtain all directories, including . and ..</td> 
</tr>

        
<tr>
<td> O_FILE</td><td> obtain a list of files</td> 
</tr>

        
<tr>
<td> O_SUBDIR</td><td> obtain all subdirectories</td> 
</tr>

        <td colspan=0><hr></td>

    
</table>
    Note that the pattern <em>*</em> will not match hidden entries under Unix-type
        operating systems. Use <em>.*</em> for that.
    <li><em>list makelist(string mask, newer, string comparefile)</em><br>
        Returns list of all files matching mask which are newer
        than a provided comparefile. Operator <em>younger</em> may be used instead
        of <em>newer</em>. Note that <em>newer</em> and <em>younger</em> are operators, not
        strings. 
    <li><em>list makelist([int = O_FILE,] string mask, newer,
             string comparefile)</em><br>
        Same as the previous function, but <em>type</em> may be specified as in
        <em>list makelist(type, string mask)</em>.
    <li><em>makelist(string mask, older, string comparefile)</em><br>
        See above; returns a list of files that are older than the 
        comparefile.
    <li><em>makelist(type, string mask, older, string comparefile)</em><br>
        Same as the previous function, but <em>type</em> may be specified as in
        <em>list makelist(type, string mask)</em>.
    </ul>
<p>
Output interface:
    <ul>    
    <li><em>int printf(...)</em><br>
        Shows all (comma separated) arguments to screen (i.e., the standard
        output stream). Returns the number of printed arguments.
    </ul>
<p>
System interface:
    <ul>    
    <li><em>int putenv(string envvar)</em><br>
        Adds <em>envvar</em> to the current (<strong>icmake</strong>) environment
        Use the format: "VAR=value". Returns 0.
    </ul>
<p>
List information:
    <ul>        
    <li><em>int sizeof(list l)</em><br>
        Returns the number of elements in <em>list</em>
    </ul>
<p>
System information:
    <ul>
    <li><em>list stat(string entry)</em><br>
        Returns <strong>stat</strong>(2) information of directory entry <em>entry</em> as 
        a list. The returned list has two elements: element 0 is the
        <em>attribute value</em>, element 1 contains the size of the file.
<p>
Attributes are  returned as bit-flags, composed from the
        following predefined constants: 
        <pre>

            S_IFCHR     S_IFDIR     S_IFREG
            S_IREAD     S_IWRITE    S_IEXEC
        
</pre>

        See the <strong>stat</strong>(2) manual page for the meanings of these constants.
    <li><em>list stat(checking, string entry)</em><br>
       Same as the previous function, but by specifying <em>checking</em> as
        <em>P_NOCHECK</em> the function won't terminate the script. Rather, it will
        rturn <strong>stat</strong>(2)'s return value.
    </ul>
<p>
String support:
    <ul>
    <li><em>int strlen(string s)</em><br>
        Returns the number of characters in <em>s</em> (not counting the final 0).
    <li><em>int strfind(string haystack, string needle)</em><br>
        returns index in <em>haystack</em> where <em>needle</em> is found, or -1 if 
        <em>needle</em> is not contained in <em>haystack</em>.<br>
        <strong>This function was called strstr() in versions before 7.00</strong>.
    <li><em>string strlwr(string s)</em><br>
        Returns a lower-case duplicate of <em>s</em>.
    <li><em>list strtok(string str, string separators)</em><br>
        Returns a list containing all substrings of <em>str</em> separated by one
        or more (consecutive) characters in <em>separators</em>. E.g.,
        <em>strtok("hello icmake's+world", " +")</em> returns the list containing
        the three strings <em>"hello"</em>, <em>"icmake's"</em>, and <em>"world"</em>.
    <li><em>string strupr(string s)</em><br>
        Returns an upper-case duplicate of <em>s</em>.
    <li><em>string substr(string text, int offset, int count)</em><br>
        Returns a substring of <em>text</em>, starting at <em>offset</em>, consisting of
        <em>count</em> characters. If <em>offset</em> exceeds (or equals) the string's
        size or if <em>count &lt;= 0</em>, then an empty string is returned. If
        <em>offset</em> is less than 0 then 0 is used.
    </ul>
<p>
System calls:
    <ul>
    <li><em>int system(string command)</em><br>
        Executes <em>command</em>. The return value indicates the executed
        command's exit value. The string <em>command</em></ul> may contain redirection
        and/or piping characters.
    <li><em>int system(int checking, string command)</em><br>
        Same functionality as the previous function, but by specifying
        <em>checking</em> as <em>P_NOCHECK</em> the function won't terminate the
        script. Rather, it will return the called command's exit status, or
        <em>0x7f00</em> if the command wasn't found.
    )
<p>
<h2>USER DEFINED FUNCTIONS</h2>
<p>
<strong>Icmake</strong> scripts may define functions, and a function <em>main()</em> <em>must</em> be
defined. Functions must have the following elements:
    <ul>
    <li> The function's return type. One of the available types must be
used explicitly, e.g., <em>void</em>. There is no default type. 
    <li> The function's name, e.g., <em>compile</em>.
    <li> A parameter list, defining zero or more comma-separated
parameters. The parameters themselves consist of a type name followed by the
parameter's identifier. E.g., <em>(string outfile, string source)</em>.
    <li> A <em>body</em> surrounded by a pair of curly braces (<em>{</em> and <em>}</em>).
<p>
Function bodies may contain (optionally initialized) variable
definitions. Variable definitions start with a type name, followed by one or
more comma separated (optionally initialized) variable identifiers.  If a
variable is not explicitly initialized it is initialized by default. An
<em>int</em> variable is initialized to 0, a <em>string</em> is initialized to empty
text (<em>""</em>) and a <em>list</em> is initialized to a list of zero elements.
<p>
Following variable definitions, bodies may contain zero or more statements
(see below at section <strong>FLOW CONTROL</strong> for the various flow-control
statements). Note that all local variables must be defined at the very
beginning of function bodies.
    </ul>
<p>
User defined functions must be defined before they can be used, although they
may be called recursively. Therefore, indirect recursion is not supported by
<strong>icmake</strong>.
<p>
The user-defined function <em>main()</em> has three optional arguments, which may
be omitted from the last one (<em>envp</em>) to the first (<em>argc</em>), as in
<strong>C</strong>. Its full prototype is (note: <strong>void</strong> return type):
        <pre>

    void main(int argc, list argv, list envp)
        
</pre>

    In <em>main()</em>,
    <ul>
    <li><em>argc</em> represents the number of elements in <em>argv</em>;
    <li><em>argv</em> contains the arguments, with element 0 the compiled <strong>icmake</strong> script
(the `<em>.bim</em>' file);
    <li><em>envp</em> containts the `environment' variables. The function <em>sizeof()</em>
(see below) may be used to determine its elements. Elements in <em>envp</em> have
the form <em>variable=value</em>. Alternatively, the function <em>getenv()</em> (see
below) can be used to retrieve a specific environment variable immediately.
    </ul>
    Example:
        <pre>

    void main(int argc, list argv)
    {
        list toCompile;
        int idx;

        if (argc == 1)
            usage(element(0, argv));

        if (toCompile = altered("*.cc"))
        {
            for (idx = sizeof(toCompile); idx--; )
                compile(element(idx, toCompile));

            if (getenv("dryrun")[0] == "0")
                linking(element(2, argv));
        }
        exit (0);
    }    
        
</pre>

<p>
<h2>FILES</h2>
<p>
The mentioned paths are sugestive only and may be installation dependent:
    <ul>
    <li> <strong>/usr/bin/icmake</strong>: the main <strong>icmake</strong> program;
    <li> <strong>/usr/bin/icmun</strong>: the <strong>icmake</strong> unassembler;
    <li> <strong>/usr/lib/icm-pp</strong>: the preprocessor called by <strong>icmake</strong>;
    <li> <strong>/usr/lib/icm-comp</strong>: the compiler called by <strong>icmake</strong>;
    <li> <strong>/usr/lib/icm-exec</strong>: the byte-code interpreter called by <strong>icmake</strong>;
    </ul>
<p>
<h2>EXAMPLES</h2>
<p>
The distribution (usually in <em>/usr/share/doc/icmake</em>) contains a
directory <em>examples</em> containing various examples of <strong>icmake</strong> script. Note in
particular the <em>examples/icmbuild</em> subdirectory containing a general script
for <strong>C++</strong> and <strong>C</strong> program maintenance.
<p>
<h2>SEE ALSO</h2>
    <strong>icmbuild</strong>(1), <strong>icmconf</strong>(7), 
    <strong>icmstart</strong>(1), <strong>icmstart.rc</strong>(7), <strong>make</strong>(1)
<p>
<h2>BUGS</h2>
    None reported
<p>
<h2>COPYRIGHT</h2>
    This is free software, distributed under the terms of the 
    GNU General Public License (GPL).
<p>
<h2>AUTHOR</h2>
    Frank B. Brokken (<strong>f.b.brokken@rug.nl</strong>).
<p>
